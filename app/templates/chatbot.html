{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="canonical" href="https://telegram.me/XtraROMsOfficial">
{% endblock %}

{% block content %}
<div class="text-center">
    <h1>XtraROMs Chatbot</h1>
</div>

<div id="chat-container">
    <!-- Display the chat messages here -->
</div>

<form id="chat-form" method="post" action="{% url 'telegram_webhook' %}">
    {% csrf_token %}
    <input type="text" id="user-input" name="user_message" placeholder="Type your message here" required>
    <button type="submit">Send</button>
</form>

<script>
    // Get the CSRF token from the cookie
    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
    }
    
    var csrfToken = getCookie('csrftoken');

    // Attach the CSRF token to the request headers
    document.querySelector('#chat-form').addEventListener('submit', function(event) {
        event.preventDefault();
        var userInput = document.querySelector('#user-input').value;
        fetch("{% url 'telegram_webhook' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ user_message: userInput })
        })
        .then(response => response.json())
        .then(data => {
            // Handle response data if needed
        })
        .catch(error => {
            // Handle error
        });
    });

    // Scroll to the bottom of the chatbox to show the latest messages
    var chatContainer = document.getElementById('chat-container');
    chatContainer.scrollTop = chatContainer.scrollHeight;
</script>
</div>
{% endblock %}
